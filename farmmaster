local name = "farmmaster"
local moniside = "left"
local modemside = "right"

os.loadAPI("apis/gobText")
os.loadAPI("apis/rx")

gobText.writeLine("Farm Manager")
gobText.writeLine("Master")
gobText.writeLine("APIs loaded")

rednet.open(modemside)
rednet.host("farmmasterstatus", name)
rednet.host("farmmastersignin", name)

gobText.writeLine("Network service started")

monitor = peripheral.wrap(moniside)
gobText.writeLine("Monitor initialised")

function update()
  -- clear screen
  for i, v in ipairs(rednet.lookup("farmsub")) do
    -- build button to open details
  end
end

rx.on("rednet_message", function(senderId, message, protocol)
  if protocol == "farmmastersignin" then
    gobText.writeLine(senderId .. " signed in as " .. message)
	rednet.send(senderId, "getStatus", "farmsub")
  elseif protocol == "farmmasterstatus" then
    gobText.writeLine(senderId .. "'s status is " .. message)
  end
end)

rx.on("monitor_touch", function(side, xPos, yPos)
  if side == moniside then
    rednet.send(rednet.lookup("farmsub", "farmsub1"), "toggleSystem Light1", "farmsub")
	gobText.writeLine("Telling " .. rednet.lookup("farmsub", "farmsub1") .. "to toggle Light1")
  end
end)

rx.run()